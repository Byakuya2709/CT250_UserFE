import{_ as f,c as n,o as l,a as t,h as d,A as u,i as m,E as p,g as w}from"./index-ocYKao6t.js";const h={name:"EmailVerification",data(){return{step:1,email:"",otp:"",newPassword:"",confirmPassword:"",validated:{password:!1,passwordConfirm:!1},step2:!1}},computed:{isValidated(){return this.validated.password&&this.validated.passwordConfirm}},watch:{newPassword(e){this.validatePassword(e)},confirmPassword(e){this.validatePasswordConfirm(e)}},methods:{async sendOtp(){var e,s;try{const a=await w.post("/auth/generate-passcode",{email:this.email});this.$toast.success(a.data.message),this.step=2}catch(a){this.$toast.error(((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"Đã xảy ra lỗi. Vui lòng thử lại.")}},async verifyOtp(){var e,s;try{const a=await w.post("/auth/account/verify",{email:this.email,code:this.otp,type:"ResetPassword"});this.$toast.success(a.data.message),this.step=3}catch(a){this.$toast.error(((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"Mã OTP không hợp lệ.")}},async resetPassword(){var e,s;if(this.isValidated)try{const a=await w.post("/auth/account/resetpassword",{email:this.email,newPassword:this.newPassword});this.$toast.success(a.data.message),setTimeout(()=>{this.$router.replace("/company/login")},2e3)}catch(a){this.$toast.error(((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"Đã xảy ra lỗi khi đổi mật khẩu.")}},validatePassword(e){const s=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;this.validated.password=s.test(e)},validatePasswordConfirm(e){this.validated.passwordConfirm=e===this.newPassword}}},c={class:"email-verification bg-light"},b={class:"d-flex justify-content-center align-items-center vh-100"},y={class:"bg-white p-4 border border-dark"},v={class:"mb-3"},P={class:"mb-3"},g={key:0,class:"info"},k={class:"mb-3"},M={key:0,class:"text-danger mt-1"},x={class:"mb-3"},O={key:0,class:"text-danger mt-1"},V=["disabled"];function T(e,s,a,C,r,i){return l(),n("div",c,[t("div",b,[t("div",y,[s[13]||(s[13]=t("h1",{class:"text-dark text-center mb-4"},"Thay đổi mật khẩu",-1)),r.step===1?(l(),n("form",{key:0,onSubmit:s[1]||(s[1]=u((...o)=>i.sendOtp&&i.sendOtp(...o),["prevent"]))},[t("div",v,[s[7]||(s[7]=t("label",{for:"email",class:"form-label"},"Nhập vào Email",-1)),m(t("input",{type:"email","onUpdate:modelValue":s[0]||(s[0]=o=>r.email=o),class:"form-control",required:""},null,512),[[p,r.email]])]),s[8]||(s[8]=t("button",{type:"submit",class:"btn btn-primary"},"Gửi Mã OTP",-1))],32)):r.step===2?(l(),n("form",{key:1,onSubmit:s[3]||(s[3]=u((...o)=>i.verifyOtp&&i.verifyOtp(...o),["prevent"]))},[t("div",P,[s[9]||(s[9]=t("label",{for:"otp",class:"form-label"},"Nhập Mã OTP",-1)),m(t("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=o=>r.otp=o),class:"form-control",required:""},null,512),[[p,r.otp]])]),r.step2?(l(),n("p",g,"Mã OTP đã được gửi đến email của bạn.")):d("",!0),s[10]||(s[10]=t("button",{type:"submit",class:"btn btn-primary"},"Xác Thực Mã OTP",-1))],32)):r.step===3?(l(),n("form",{key:2,onSubmit:s[6]||(s[6]=u((...o)=>i.resetPassword&&i.resetPassword(...o),["prevent"]))},[t("div",k,[s[11]||(s[11]=t("label",{for:"newPassword",class:"form-label"},"Nhập Mật Khẩu Mới",-1)),m(t("input",{type:"password","onUpdate:modelValue":s[4]||(s[4]=o=>r.newPassword=o),class:"form-control",required:""},null,512),[[p,r.newPassword]]),r.validated.password?d("",!0):(l(),n("p",M," Mật khẩu phải gồm ít nhất 8 kí tự bao gồm chữ thường/HOA và 1 số. "))]),t("div",x,[s[12]||(s[12]=t("label",{for:"confirmPassword",class:"form-label"},"Xác Nhận Mật Khẩu Mới",-1)),m(t("input",{type:"password","onUpdate:modelValue":s[5]||(s[5]=o=>r.confirmPassword=o),class:"form-control",required:""},null,512),[[p,r.confirmPassword]]),r.validated.passwordConfirm?d("",!0):(l(),n("p",O," Vui lòng nhập đúng lại mật khẩu đã nhập. "))]),t("button",{type:"submit",class:"btn btn-primary",disabled:!i.isValidated}," Đổi Mật Khẩu ",8,V)],32)):d("",!0)])])])}const q=f(h,[["render",T]]);export{q as default};
