import{_ as f,c as n,o as d,a as e,h as p,A as u,i as h,E as m,g as c,G as w}from"./index-ocYKao6t.js";const y={name:"Register",data(){return{email:"",password:"",confirmPassword:"",otp:"",role:"USER",showOtpModal:!1}},computed:{isEmailValid(){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(this.email)},isFormValid(){return this.isEmailValid&&this.password.length>=6&&this.password===this.confirmPassword}},created(){const r=this.$route.path;r.includes("company")?this.role="COMPANY":r.includes("artist")&&(this.role="ARTIST")},methods:{async handleRegister(){var r,s;if(this.isFormValid)try{const i={email:this.email},a=await c.post("/auth/generate",i);a.status===200?(this.$toast.success(a.data.message),this.showOtpModal=!0):(this.$toast.warning(a.data.message),this.showOtpModal=!0)}catch(i){console.log(i),this.$toast.error(((s=(r=i.response)==null?void 0:r.data)==null?void 0:s.message)||"Đã xảy ra lỗi")}},async handleOtpVerification(){var r,s;if(this.otp)try{const i={email:this.email,password:this.password,role:this.role,code:this.otp,type:"Registration"},a=await c.post("/auth/register",i);if(a.status===201){this.$toast.success(a.data.message),sessionStorage.setItem("UserEmail",this.email);const t={email:this.email,password:this.password},l=w(),{loginResponse:o,role:g}=await l.login(t,"user");console.log(o),console.log(g),o.status===200?(this.$toast.success(o.data.message),this.$router.push({path:`/${this.role.toLocaleLowerCase()}s/create`,query:{accountId:a.data.data.id}})):this.$toast.warning(o.data.message)}else this.$toast.warning(a.data.message)}catch(i){console.log(i),this.$toast.error(((s=(r=i.response)==null?void 0:r.data)==null?void 0:s.message)||"Đã xảy ra lỗi")}finally{this.showOtpModal=!1}else this.$toast.error("Vui lòng nhập mã OTP.")}}},b={class:"register-container"},k={class:"register-box"},V={class:"form-group"},O={key:0,class:"error-message"},P={class:"form-group"},_={key:0,class:"error-message"},v={class:"form-group"},M={key:0,class:"error-message"},x=["disabled"],E={key:0,class:"otp-modal"},R={class:"otp-box"},N={class:"form-group"},T=["disabled"];function A(r,s,i,a,t,l){return d(),n("div",b,[e("div",k,[s[11]||(s[11]=e("h2",null,"Đăng Ký",-1)),e("form",{onSubmit:s[3]||(s[3]=u((...o)=>l.handleRegister&&l.handleRegister(...o),["prevent"]))},[e("div",V,[s[6]||(s[6]=e("label",{for:"email"},"Email",-1)),h(e("input",{type:"email",id:"email","onUpdate:modelValue":s[0]||(s[0]=o=>t.email=o),placeholder:"Nhập email",required:"",autofocus:""},null,512),[[m,t.email]]),t.email&&!l.isEmailValid?(d(),n("p",O," Email không hợp lệ. ")):p("",!0)]),e("div",P,[s[7]||(s[7]=e("label",{for:"password"},"Mật khẩu",-1)),h(e("input",{type:"password",id:"password","onUpdate:modelValue":s[1]||(s[1]=o=>t.password=o),placeholder:"Nhập mật khẩu",required:""},null,512),[[m,t.password]]),t.password&&t.password.length<6?(d(),n("p",_," Mật khẩu phải ít nhất 6 ký tự. ")):p("",!0)]),e("div",v,[s[8]||(s[8]=e("label",{for:"confirmPassword"},"Xác nhận mật khẩu",-1)),h(e("input",{type:"password",id:"confirmPassword","onUpdate:modelValue":s[2]||(s[2]=o=>t.confirmPassword=o),placeholder:"Nhập lại mật khẩu",required:""},null,512),[[m,t.confirmPassword]]),t.confirmPassword&&t.confirmPassword!==t.password?(d(),n("p",M," Mật khẩu xác nhận không khớp. ")):p("",!0)]),e("button",{type:"submit",disabled:!l.isFormValid},"Đăng Ký",8,x)],32),t.showOtpModal?(d(),n("div",E,[e("div",R,[s[10]||(s[10]=e("h3",null,"Nhập mã OTP",-1)),e("form",{onSubmit:s[5]||(s[5]=u((...o)=>l.handleOtpVerification&&l.handleOtpVerification(...o),["prevent"]))},[e("div",N,[s[9]||(s[9]=e("label",{for:"otp"},"Mã OTP",-1)),h(e("input",{type:"text",id:"otp","onUpdate:modelValue":s[4]||(s[4]=o=>t.otp=o),placeholder:"Nhập mã OTP",required:""},null,512),[[m,t.otp]])]),e("button",{type:"submit",disabled:!t.otp},"Xác nhận OTP",8,T)],32)])])):p("",!0)])])}const U=f(y,[["render",A],["__scopeId","data-v-813a206b"]]);export{U as default};
