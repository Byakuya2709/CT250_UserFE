import{_ as w,c as a,o as i,a as e,h as m,t as o,F as c,f as v,n as k,e as u,i as h,v as p,g as y}from"./index-ocYKao6t.js";import{f as P}from"./format-Dp1kM_9R.js";const T=[2024,2025,2026,2027],E=["01","02","03","04","05","06","07","08","09",10,11,12],x=[{value:"music",label:"Music"},{value:"art",label:"Art"},{value:"theater",label:"Theater"}],_={data(){return{topRatedEvents:[],loading:!0,error:null,events:[],selectedTag:x[0].value,eventsByTag:[],currentPage:1,itemsPerPage:8,totalPages:1,totalElements:0,availableYears:T,months:E,filters:{companyId:"",eventStatus:"",year:"",month:""}}},computed:{paginatedAccounts(){return(this.currentPage-1)*this.itemsPerPage+this.itemsPerPage,this.events},eventTags(){return x},invalidFilter(){return!this.filters.month&&!this.filters.year?!1:this.filters.month&&!this.filters.year||this.filters.year&&!this.filters.month}},methods:{formatCurrency:P,async fetchEventsByTag(l){if(l)try{const t=await y.get("/public/tag",{params:{tag:l}});this.eventsByTag=t.data.data,console.log(this.eventsByTag)}catch(t){this.error="Lỗi khi lấy danh sách sự kiện theo tag",console.error(t)}},async fetchTopRatedEvents(){try{const l=await y.get("/public/top-rated");this.topRatedEvents=l.data}catch(l){this.error="Lỗi khi lấy danh sách sự kiện top-rated",console.error(l)}},getPosterImage(l){return l.find(t=>t.includes("poster.jpg"))||l[0]},async getEvents(){this.loading=!0;const{eventStatus:l,year:t,month:g}=this.filters;try{const d=await y.get(`/public/filter?page=${this.currentPage-1}&companyId=${this.filters.companyId}&size=${this.itemsPerPage}&eventStatus=${l}&month=${g}&year=${t}`);d.data.status==="OK"?(this.events=d.data.data.content,console.log(this.events),this.totalPages=d.data.data.totalPages):(this.$toast.error("Error fetching events"),console.error("Error fetching events:",d.data.message))}catch(d){console.error("Error fetching events:",d),this.$toast.error("Error fetching events")}finally{this.loading=!1}},applyFilters(){if(this.invalidFilter){console.warn("Lỗi: Nếu chọn tháng thì phải chọn năm và ngược lại!");return}this.currentPage=1,this.getEvents()},clearFilters(){this.filters.companyId="",this.filters.eventStatus="",this.filters.year="",this.filters.month="",this.applyFilters()},formatDate(l){return new Date(l).toLocaleString()},calculateAverageRating(l){let t=0,g=0;for(let d in l.eventRatingStart){let r=l.eventRatingStart[d];g+=d*r,t+=r}return t===0?0:g/t},getStars(l){const t=this.calculateAverageRating(l),g=Math.floor(t),d=t%1>=.5?1:0,r=5-g-d;return{fullStars:g,halfStars:d,emptyStars:r}},goToEventDetails(l){this.$router.push({path:`/events/${l}`})},prevPage(){this.currentPage>1&&(this.currentPage--,this.getEvents())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.getEvents())},toDetail(l){this.$router.push({path:`/events/${l}`})},calculateAverageRating2(l){if(!l)return 0;let t=0,g=0;return Object.keys(l).forEach(d=>{const r=l[d];t+=r,g+=parseInt(d)*r}),t?(g/t).toFixed(1):0}},async mounted(){await this.fetchTopRatedEvents(),await this.getEvents(),await this.fetchEventsByTag(x[0].value),this.loading=!1}},S={class:"mx-auto"},D={key:0,class:"d-flex justify-content-center"},C={key:1,class:"alert alert-danger"},I={key:2},R={id:"topRatedEventsCarousel",class:"carousel slide","data-bs-ride":"carousel"},L={class:"carousel-inner"},B=["src"],F={class:"carousel-caption d-none d-md-block bg-dark bg-opacity-50 p-3 rounded"},N={class:"event-rating"},A={class:"rating-value"},V=["onClick"],K={class:"flex mx-auto p-4 border border-gray-300"},U={class:"w-1/4 p-4 border-r border-gray-300"},j={class:"bg-white p-4 rounded-lg shadow-md"},M=["value"],G=["value"],O={key:0,class:"text-red-500 mb-2"},z={class:"flex space-x-2 mt-4"},H=["disabled"],X={class:"w-3/4 p-4"},Y={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-6"},q=["onClick"],J={class:"text-lg font-semibold mb-2"},Q={class:"text-gray-600 mb-2 truncate"},W={class:"text-sm"},Z={class:"text-sm"},$={class:"text-sm"},tt={class:"text-sm"},et=["src"],st={class:"flex justify-between items-center mt-6"},rt=["disabled"],lt={class:"font-semibold"},nt=["disabled"],ot={class:"flex mx-auto p-4 border border-gray-300"},at={class:"w-1/4 p-4 border-r border-gray-300"},it={class:"bg-white p-4 rounded-lg shadow-md"},dt=["value"],ut={class:"w-3/4 p-4"},gt={key:0,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-6"},ct=["onClick"],vt={class:"text-lg font-semibold mb-2"},mt={class:"text-gray-600 mb-2 truncate"},ht={class:"text-sm"},pt={class:"text-sm"},ft={class:"text-sm"},bt={class:"text-sm"},yt=["src"],xt={key:1,class:"font-bold text-lg"};function kt(l,t,g,d,r,n){return i(),a(c,null,[e("div",S,[e("div",null,[t[15]||(t[15]=e("h2",{class:"text-4xl font-bold text-gray-800 p-4 text-center",style:{background:"#f3e8ff"}}," Sự kiện nổi bật ",-1)),r.loading?(i(),a("div",D,t[9]||(t[9]=[e("div",{class:"spinner-border text-primary",role:"status"},null,-1)]))):m("",!0),r.error?(i(),a("div",C,o(r.error),1)):m("",!0),!r.loading&&r.topRatedEvents.length>0?(i(),a("div",I,[e("div",R,[e("div",L,[(i(!0),a(c,null,v(r.topRatedEvents,(s,f)=>(i(),a("div",{key:s.eventId,class:k(["carousel-item",{active:f===0}])},[e("img",{src:s.eventListImgURL[0],class:"d-block w-100 carousel-img",alt:"Event Image"},null,8,B),e("div",F,[e("h5",null,o(s.eventTitle),1),e("div",N,[(i(),a(c,null,v(5,b=>e("span",{key:b,class:k(["star",{filled:b<=Math.round(n.calculateAverageRating2(s.eventRatingStart))}])},"⭐",2)),64)),e("span",A,"("+o(n.calculateAverageRating2(s.eventRatingStart))+"/5)",1)]),e("p",null,[u(" 📍 "+o(s.eventAddress),1),t[10]||(t[10]=e("br",null,null,-1)),u("📅 "+o(new Date(s.eventStartDate).toLocaleDateString()),1),t[11]||(t[11]=e("br",null,null,-1)),t[12]||(t[12]=u("💰 ")),e("strong",null,o(s.eventPrice.toLocaleString())+" VND",1)]),e("button",{class:"btn btn-primary",onClick:b=>n.toDetail(s.eventId)}," Xem chi tiết ",8,V)])],2))),128))]),t[13]||(t[13]=e("button",{class:"carousel-control-prev",type:"button","data-bs-target":"#topRatedEventsCarousel","data-bs-slide":"prev"},[e("span",{class:"carousel-control-prev-icon","aria-hidden":"true"})],-1)),t[14]||(t[14]=e("button",{class:"carousel-control-next",type:"button","data-bs-target":"#topRatedEventsCarousel","data-bs-slide":"next"},[e("span",{class:"carousel-control-next-icon","aria-hidden":"true"})],-1))])])):m("",!0)])]),t[34]||(t[34]=e("h2",{class:"text-4xl font-bold text-gray-800 p-4 text-center",style:{background:"#f3e8ff"}}," Tất Cả Sự Kiện ",-1)),e("div",K,[e("div",U,[e("div",j,[t[19]||(t[19]=e("h2",{class:"text-lg font-semibold mb-4"},"Bộ lọc",-1)),t[20]||(t[20]=e("label",{for:"eventStatus",class:"block text-sm font-medium text-gray-700"},"Trạng thái:",-1)),h(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>r.filters.eventStatus=s),id:"eventStatus",class:"w-full p-2 border rounded mb-4"},t[16]||(t[16]=[e("option",{value:""},"Tất cả",-1),e("option",{value:"UP_COMMING"},"Sắp Diễn Ra",-1),e("option",{value:"CANCELLED"},"Đã Hủy",-1),e("option",{value:"ENDED"},"Đã Kết Thúc",-1)]),512),[[p,r.filters.eventStatus]]),t[21]||(t[21]=e("label",{for:"month",class:"block text-sm font-medium text-gray-700"},"Tháng:",-1)),h(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>r.filters.month=s),id:"month",class:"w-full p-2 border rounded mb-4"},[t[17]||(t[17]=e("option",{value:""},"Tất cả",-1)),(i(!0),a(c,null,v(r.months,s=>(i(),a("option",{key:s,value:s},o(s),9,M))),128))],512),[[p,r.filters.month]]),t[22]||(t[22]=e("label",{for:"year",class:"block text-sm font-medium text-gray-700"},"Năm:",-1)),h(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>r.filters.year=s),id:"year",class:"w-full p-2 border rounded mb-4"},[t[18]||(t[18]=e("option",{value:""},"Tất cả",-1)),(i(!0),a(c,null,v(r.availableYears,s=>(i(),a("option",{key:s,value:s},o(s),9,G))),128))],512),[[p,r.filters.year]]),n.invalidFilter?(i(),a("p",O," Nếu chọn tháng thì phải chọn năm và ngược lại! ")):m("",!0),e("div",z,[e("button",{onClick:t[3]||(t[3]=(...s)=>n.applyFilters&&n.applyFilters(...s)),class:"bg-blue-500 text-white px-4 py-2 rounded",disabled:n.invalidFilter}," Áp dụng ",8,H),e("button",{onClick:t[4]||(t[4]=(...s)=>n.clearFilters&&n.clearFilters(...s)),class:"bg-gray-500 text-white px-4 py-2 rounded"}," Xóa ")])])]),e("div",X,[e("div",Y,[(i(!0),a(c,null,v(n.paginatedAccounts,s=>(i(),a("div",{key:s.eventId,class:"bg-white shadow-lg rounded-lg p-4 hover:scale-105 cursor-pointer",onClick:f=>n.goToEventDetails(s.eventId)},[e("h3",J,o(s.eventTitle),1),e("p",Q,o(s.eventDescription),1),e("p",W,[t[23]||(t[23]=e("strong",null,"Ngày Bắt đầu:",-1)),u(" "+o(n.formatDate(s.eventStartDate)),1)]),e("p",Z,[t[24]||(t[24]=e("strong",null,"Ngày Kết Thúc:",-1)),u(" "+o(n.formatDate(s.eventEndDate)),1)]),e("p",$,[t[25]||(t[25]=e("strong",null,"Giá:",-1)),u(" "+o(n.formatCurrency(s.eventPrice)),1)]),e("p",tt,[t[26]||(t[26]=e("strong",null,"Trạng thái:",-1)),u(" "+o(s.eventStatus),1)]),e("img",{src:n.getPosterImage(s.eventListImgURL),alt:"Event Image",class:"w-full h-40 object-cover mt-3 rounded-md"},null,8,et)],8,q))),128))]),e("div",st,[e("button",{onClick:t[5]||(t[5]=(...s)=>n.prevPage&&n.prevPage(...s)),disabled:r.currentPage===1,class:"px-4 py-2 bg-blue-500 text-white rounded disabled:opacity-50"},t[27]||(t[27]=[e("i",{class:"fas fa-chevron-left"},null,-1),u(" Trang trước ")]),8,rt),e("span",lt,"Trang "+o(r.currentPage)+" / "+o(r.totalPages),1),e("button",{onClick:t[6]||(t[6]=(...s)=>n.nextPage&&n.nextPage(...s)),disabled:r.currentPage>=r.totalPages,class:"px-4 py-2 bg-blue-500 text-white rounded disabled:opacity-50"},t[28]||(t[28]=[u(" Trang sau "),e("i",{class:"fas fa-chevron-right"},null,-1)]),8,nt)])])]),t[35]||(t[35]=e("h2",{class:"text-4xl font-bold text-gray-800 text-center p-4",style:{background:"#f3e8ff"}}," Sự Kiện Sắp Diễn Ra ",-1)),e("div",ot,[e("div",at,[e("div",it,[t[29]||(t[29]=e("h2",{class:"text-lg font-semibold mb-4"},"Thể Loại",-1)),h(e("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>r.selectedTag=s),class:"w-full p-2 border rounded mb-4"},[(i(!0),a(c,null,v(n.eventTags,s=>(i(),a("option",{key:s.value,value:s.value},o(s.label),9,dt))),128))],512),[[p,r.selectedTag]]),e("button",{onClick:t[8]||(t[8]=s=>n.fetchEventsByTag(r.selectedTag)),class:"bg-blue-500 text-white px-4 py-2 rounded w-full sm:w-auto"}," Áp dụng ")])]),e("div",ut,[r.eventsByTag?(i(),a("div",gt,[(i(!0),a(c,null,v(r.eventsByTag,s=>(i(),a("div",{key:s.eventId,class:"bg-white shadow-lg rounded-lg p-4 hover:scale-105 cursor-pointer",onClick:f=>n.goToEventDetails(s.eventId)},[e("h3",vt,o(s.eventTitle),1),e("p",mt,o(s.eventDescription),1),e("p",ht,[t[30]||(t[30]=e("strong",null,"Ngày Bắt đầu:",-1)),u(" "+o(n.formatDate(s.eventStartDate)),1)]),e("p",pt,[t[31]||(t[31]=e("strong",null,"Ngày Kết Thúc:",-1)),u(" "+o(n.formatDate(s.eventEndDate)),1)]),e("p",ft,[t[32]||(t[32]=e("strong",null,"Giá:",-1)),u(" "+o(n.formatCurrency(s.eventPrice)),1)]),e("p",bt,[t[33]||(t[33]=e("strong",null,"Trạng thái:",-1)),u(" "+o(s.eventStatus),1)]),e("img",{src:n.getPosterImage(s.eventListImgURL),alt:"Event Image",class:"w-full h-40 object-cover mt-3 rounded-md"},null,8,yt)],8,ct))),128))])):(i(),a("div",xt,"Không có sự kiện nào"))])])],64)}const Tt=w(_,[["render",kt],["__scopeId","data-v-b6b17abf"]]);export{Tt as default};
